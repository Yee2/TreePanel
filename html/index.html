<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>系统信息</title>
    <style>
        #main {
            max-width: 768px;
            margin: 0 auto;
            height: 100vh;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 10px;
        }

        #main table tr td {
            padding: 5px;
        }

        table, table tr th, table tr td {
            border: 1px solid #787878;
        }
    </style>
</head>
<body>
<div id="main">
    <button id="btn">刷新</button>
    <table>
        <tr>
            <th colspan="2">内存信息</th>
        </tr>
        <tr>
            <td>可用</td>
            <td id="mem-free"></td>
        </tr>
        <tr>
            <td>已用</td>
            <td id="mem-used"></td>
        </tr>
        <tr>
            <td>总数</td>
            <td id="mem-total"></td>
        </tr>
    </table>
    <table>
        <tr>
            <th colspan="4">磁盘信息</th>
        </tr>
        <tr>
            <th>路径</th>
            <th>已用</th>
            <th>可用</th>
            <th>容量</th>
        </tr>
        <tbody id="disk-body">
        <tr><td colspan="4">加载中...</td></tr>
        </tbody>
    </table>
    <table>
        <tr>
            <th colspan="3">处理器</th>
        </tr>
        <tr>
            <th>名称</th>
            <th>频率</th>
            <th>核心数</th>
        </tr>
        <tbody id="cpu-body">
        <tr><td colspan="3">加载中...</td></tr>

        </tbody>
    </table>
    <table>
        <tr>
            <th colspan="3">网络信息</th>
        </tr>
        <tr>
            <th>设备名</th>
            <th>硬件地址</th>
            <th>IP地址</th>
        </tr>
        <tbody id="interface-body">
        <tr><td colspan="3">加载中...</td></tr>
        </tbody>
    </table>
</div>

<script>

    function formatBytes(bytes, decimals = 2) {
        if (bytes === 0) return '0 Bytes';

        const k = 1024;
        const dm = decimals < 0 ? 0 : decimals;
        const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];

        const i = Math.floor(Math.log(bytes) / Math.log(k));

        return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    document.querySelector("#btn").addEventListener("click", load);

    load();

    function load() {

        fetch("/memory.json")
            .then(resp => resp.json())
            .then(function (myJson) {
                document.querySelector("#mem-free").innerHTML = formatBytes(myJson.available);
                document.querySelector("#mem-used").innerHTML = formatBytes(myJson.used);
                document.querySelector("#mem-total").innerHTML = formatBytes(myJson.total);
            })
            .then(() => fetch("/cpu.json"))
            .then(resp => resp.json())
            .then(function (list) {
                let html = "";
                for (let item of list) {
                    html += `<tr><td>${item.modelName}</td><td>${item.mhz} mhz</td>` +
                        `<td>${item.cores}</td></tr>`;
                }
                document.querySelector("#cpu-body").innerHTML = html;
            })
            .then(() => fetch("/disk.json"))
            .then(resp => resp.json())
            .then(list => {
                let html = "";
                for (let item of list) {
                    html += `<tr class="disk-tr"><td>${item.path}</td><td>${formatBytes(item.used)}</td>` +
                        `<td>${formatBytes(item.free)}</td><td>${formatBytes(item.total)}</td></tr>`;
                }
                document.querySelector("#disk-body").innerHTML = html;
            })
            .then(() => fetch("/interface.json"))
            .then(resp => resp.json())
            .then(interfaces => {
                let html = "";
                for (let item of interfaces) {
                    let addr = item.addrs.map(e => e.addr).join("<br />")
                    html += `<tr class="disk-tr"><td>${item.name}</td><td>${item.hardwareaddr}</td>` +
                        `<td>${addr}</td></tr>`;
                }
                document.querySelector("#interface-body").innerHTML = html;
            })

    }
</script>
</body>
</html>